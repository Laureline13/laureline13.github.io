<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paiement</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <h1>Récapitulatif de la commande</h1>
    <div id="recapitulatif"></div>
    <button onclick="genererFacture()">Télécharger la facture</button>

    <script>
        function chargerRecapitulatif() {
            let recap = JSON.parse(localStorage.getItem("recapCommande"));
            if (!recap) return document.getElementById("recapitulatif").innerHTML = "Aucune commande trouvée.";

            document.getElementById("recapitulatif").innerHTML = `
                <p><strong>Nom :</strong> ${recap.nom}</p>
                <p><strong>Prénom :</strong> ${recap.prenom}</p>
                <p><strong>Adresse :</strong> ${recap.adresse}</p>
                <p><strong>Pharmacie :</strong> ${recap.pharmacie}</p>
                ${recap.commande.map(item => `<p>${item.nom} x ${item.quantite} = ${item.prix.toFixed(2)}€</p>`).join("")}
                <p><strong>Total :</strong> ${recap.total.toFixed(2)}€</p>
            `;
        }

        function genererFacture() {
            let { jsPDF } = window.jspdf;
            let doc = new jsPDF();
            let recap = JSON.parse(localStorage.getItem("recapCommande"));
            if (!recap) return alert("Aucune commande trouvée.");

            doc.text("Facture", 10, 10);
            recap.commande.forEach((item, i) => doc.text(`${item.nom} x ${item.quantite} = ${item.prix.toFixed(2)}€`, 10, 20 + i * 10));
            doc.text(`Total : ${recap.total.toFixed(2)}€`, 10, 50);
            doc.save("facture.pdf");
        }

        window.onload = chargerRecapitulatif;
    </script>
</body>
</html>
